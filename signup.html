<?php
$servername = "localhost";
$username = "username";
$password = "password";
$dbname = "database_name";

// Create a connection
$conn = mysqli_connect("localhost", "root", "", "log");

// Check connection
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}

// Get form data
$username = mysqli_real_escape_string($conn, $_POST['username']);
$email = mysqli_real_escape_string($conn, $_POST['email']);
$password = mysqli_real_escape_string($conn, $_POST['password']);

// Check if user already exists
$sql = "SELECT COUNT(*) as count FROM users WHERE username='$username' OR email='$email'";
$result = mysqli_query($conn, $sql);
$row = mysqli_fetch_assoc($result);

if ($row['count'] > 0) {
    // User already exists
    echo "<script>
              alert('User with that username or email already exists.');
              window.location.href = 'registration.html';
          </script>";

} else {
    // Insert user data into database
    $sql = "INSERT INTO users (username, email, password) VALUES ('$username', '$email', PASSWORD('$password'))";

    if (mysqli_query($conn, $sql)) {
        echo "<script>
                  alert('New user added successfully');
                  window.location.href = 'registration.html';
              </script>";
              
    } else {
        echo "<script>
                  alert('Error: " . $sql . "<br>" . mysqli_error($conn) . "');
                  window.location.href = 'registration.html';
              </script>";

    }
}

mysqli_close($conn);
?>